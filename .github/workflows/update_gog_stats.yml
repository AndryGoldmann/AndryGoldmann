name: Update GOG Profile Table

on: [push]  # Triggers on any push (e.g., when you upload/update the CSV)

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4  # Check out the repo

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip install pandas

      - name: Generate and Insert Table
        run: |
          python -c "
          import pandas as pd
          df = pd.read_csv('my_gog_games.csv')  # Your CSV file
          if 'Playtime (minutes)' in df.columns:
              df['Playtime (hours)'] = df['Playtime (minutes)'] / 60  # Convert if needed
          df = df.sort_values('Playtime (hours)', ascending=False).head(20)  # Top 20 by playtime
          md_table = df[['Name', 'Playtime (hours)', 'Genre']].to_markdown(index=False)  # Adjust columns as needed
          with open('README.md', 'r') as f:
              content = f.read()
          new_content = content.replace('<!-- GOG_TABLE -->', md_table)
          with open('README.md', 'w') as f:
              f.write(new_content)
          "

      - name: Commit Changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Update GOG games table from CSV"
          file_pattern: README.md
